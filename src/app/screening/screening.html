import { Component, Input, EventEmitter, Output, OnInit } from '@angular/core';


import * as Survey from 'survey-angular';


import 'bootstrap/dist/css/bootstrap.css';
import 'survey-angular/survey.css';
import {SurveyModel} from 'survey-angular';
import {QuestionService} from '../question.service';

Survey.StylesManager.applyTheme('bootstrap');

@Component({
  // tslint:disable-next-line:component-selector
  selector: 'survey',
  template: `<h2 class="text-center">COVID-19 Symptom Self-Assessment Tool</h2><div class="survey-container contentcontainer codecontainer">
    <div id="surveyElement"></div>
  </div>`
})
export class SurveyComponent implements OnInit {
  @Output() submitSurvey = new EventEmitter<any>();
  @Input()
  result: any;
  private questionService: QuestionService;

  constructor(questionService: QuestionService) {
    this.questionService = questionService;
  }

  ngOnInit(): void {

    const myCss = {
      root: 'sv_main sv_bootstrap_css border',
      container: 'sv_container',
      header: 'panel-heading card-header',
      body: 'panel-body card-block mt-4',
      bodyEmpty: 'panel-body card-block mt-4 sv_body_empty',
      footer: 'panel-footer card-footer',
      title: '',
      description: '',
      logo: 'sv_logo',
      logoImage: 'sv_logo__image',
      headerText: 'sv_header__text',
      navigationButton: '',
      completedPage: '',
      navigation: {
        complete: 'btn btn-lg btn-success',
        prev: 'btn sv_prev_btn',
        next: 'btn sv_next_btn',
        start: 'btn sv_start_btn',
        preview: 'btn sv_preview_btn',
        edit: 'btn sv_edit_btn'
      },
     
      pageTitle: '',
      pageDescription: 'small',
      row: 'sv_row',
      question: {
        mainRoot: 'sv_qstn',
        flowRoot: 'sv_q_flow sv_qstn',
        header: '',
        headerLeft: 'title-left',
        content: '',
        contentLeft: 'content-left',
        titleLeftRoot: 'sv_qstn_left',
        title: 'text-center',
        titleExpandable: 'sv_q_title_expandable',
        number: 'sv_q_num',
        description: 'small',
        descriptionUnderInput: 'small',
        requiredText: 'sv_q_required_text',
        comment: 'form-control',
        required: '',
        titleRequired: '',
        hasError: 'has-error',
        indent: 20,
        formGroup: 'form-group'
      },
      panel: {
        title: 'sv_p_title',
        titleExpandable: 'sv_p_title_expandable',
        titleOnError: '',
        icon: 'sv_panel_icon',
        iconExpanded: 'sv_expanded',
        description: 'small sv_p_description',
        container: 'sv_p_container',
        footer: 'sv_p_footer',
        number: 'sv_q_num',
        requiredText: 'sv_q_required_text'
      },
      error: {
        root: 'alert alert-danger',
        icon: 'glyphicon glyphicon-exclamation-sign',
        item: '',
        locationTop: 'sv_qstn_error_top',
        locationBottom: 'sv_qstn_error_bottom'
      },
      boolean: {
        root: 'sv_qbln form-inline checkbox',
        item: 'sv-boolean',
        control: 'sv-visuallyhidden',
        itemChecked: 'sv-boolean--checked checked',
        itemIndeterminate: 'sv-boolean--indeterminate',
        itemDisabled: 'sv-boolean--disabled',
        switch: 'sv-boolean__switch',
        slider: 'sv-boolean__slider',
        label: 'sv-boolean__label ',
        disabledLabel: 'sv-boolean__label--disabled',
        materialDecorator: 'sv-item__decorator sv-boolean__decorator ',
        itemDecorator: 'sv-item__svg  sv-boolean__svg',
        checkedPath: 'sv-boolean__checked-path',
        uncheckedPath: 'sv-boolean__unchecked-path',
        indeterminatePath: 'sv-boolean__indeterminate-path'
      },
      radiogroup: {
        root: 'sv_qcbc form-inline text-center',
        item: 'radio',
        itemChecked: 'checked',
        itemInline: 'sv_q_radiogroup_inline',
        label: '',
        labelChecked: '',
        itemControl: 'btn-check',
        itemDecorator: 'sv-hidden',
        controlLabel: 'btn btn-primary btn-md',
        materialDecorator: 'circle',
        other: 'sv_q_radiogroup_other form-control',
        clearButton: 'sv_q_radiogroup_clear button',
        column: 'sv_q_select_column'
      },
     xt: 'form-control',
      expression: 'form-control',
      file: {
        root: 'sv_q_file',
        placeholderInput: 'sv_q_file_placeholder',
        preview: 'sv_q_file_preview',
        removeButton: 'sv_q_file_remove_button',
        fileInput: 'sv_q_file_input',
        removeFile: 'sv_q_file_remove',
        removeFileSvg: 'sv-hidden',
        fileDecorator: 'sv-hidden',
        fileSignBottom: 'sv-hidden',
        removeButtonBottom: 'sv-hidden'
      },
      saveData: {
        root: '',
        saving: 'alert alert-info',
        error: 'alert alert-danger',
        success: 'alert alert-success',
        saveAgainButton: ''
      },
      window: {
        root: 'modal-content',
        body: 'modal-body',
        header: {
          root: 'modal-header panel-title',
          title: 'pull-left',
          button: 'glyphicon pull-right',
          buttonExpanded: 'glyphicon pull-right glyphicon-chevron-up',
          buttonCollapsed: 'glyphicon pull-right glyphicon-chevron-down'
        }
      }
    };

    const json = { showQuestionNumbers: 'off',
      questions: [
        {
          type: 'radiogroup',
          name: 'Please select the reason that best applies to your situation:',
          title: ' ',
          choices: ['I have been identified as having been in close contact with someone who has COVID-19', 'I received a notification from the COVID Alert App', 'I received a request by Public Health, 'I experienced a risky situation or had similar behaviour', 'I am worried / anxious / Other reason'],
          colCount: 0
        },
        {
          type: 'radiogroup',
          name: 'Have you had symptoms of COVID-19?',
          title: ' ',
          visibleIf: '{I received a notification from the COVID Alert App}=\'Yes\'',
          choices: ['Yes', 'No'],
          colCount: 0
        },
    
        {
          type: 'html',
          name: 'agerange1-1options-text',
          visibleIf: '{agerange1-options}=\'Yes\' || {agerange2}=\'Yes\'|| {agerange2-option}=\'Yes\' || {agerange3}=\'Yes\'',
          html: '' +
            '<div class="d-flex"><h6 class="mx-auto justify-content-center">Are you or the person who is going to get tested in one of the situations below?</h6></div>' +
            '<div class="d-flex">' +
            '<ul class="mx-auto justify-content-center">' +
            '<li>Is 0 to 3 months old</li>' +
            '<li>Is experiencing an obstruction of nasal passages other than normal congestion</li>' +
            '<li>Is currently having a nosebleed episode</li>' +
            '<li>Has had a nosebleed episode in the past week</li>' +
            '<li>Has undergone any of the following types of surgery:' +
            '<ul>' +
            '<li>Mouth surgery in the past week?</li>' +
            '<li>Nose surgery in the past month (adult) OR</li>' +
            '<li>Nose surgery in the past 3 weeks (child)</li>' +
            '</ul>' +
            '</li>' +
            '<li>Is currently wheezing.</li>' +
            '</ul>' +
            '</div>',
          colCount: 0
        },
        {
          type: 'radiogroup',
          name: 'agerange1-1options',
          title: ' ',
          visibleIf: '{agerange1-options}=\'Yes\' || {agerange2}=\'Yes\'|| {agerange2-option}=\'Yes\' || {agerange3}=\'Yes\'',
          choices: ['Yes', 'No'],
          colCount: 0
        },
    


        {
          type: 'radiogroup',
          name: 'submit-for-recommendation',
          title: ' ',
          visibleIf: '{agerange1-1options}=\'Yes\'||{haveTroubleBreating}=\'Yes\'||{agerange2-1}=\'Yes\'||{agerange2-1}=\'No\'',
          choices: ['Submit'],
          colCount: 0
        },


      ]
    };
    const survey = new Survey.Model(json);
    survey
      .onComplete
      // tslint:disable-next-line:only-arrow-functions
      .add(function(result) {
        console.log(JSON.stringify(result.data, null, 3));

        const xhr = new XMLHttpRequest();
        xhr.open('POST', 'http://localhost:8080/questions/saveAll');
        xhr.setRequestHeader('Content-Type', 'application/json; charset=utf-8');
        xhr.send(JSON.stringify(result.data));
      });


    Survey.SurveyNG.render('surveyElement', {model: survey, css: myCss });
  }


}
